package Ejercicio4;

import messagepassing.MailBox;


public class ControladorCaja extends Thread {
	private MailBox[] buzonesControlador;
	private MailBox[] buzonesPersonas;


	public ControladorCaja(MailBox[] buzonesControlador, MailBox[] buzonesPersonas) {
		this.buzonesControlador = buzonesControlador;
		this.buzonesPersonas = buzonesPersonas;
	}

	public void run() {
		while(true) {
			for (int i = 0; i < Programa.NUMERO_GLOBAL; i++) {

				
				String recibido = (String) buzonesPersonas[i].receive();

				if(recibido.equals(Programa.PEDIR)) {
					int tiempo = (int) (Math.random() * 9000 + 1000);
					String respuesta = tiempo >= 5000 ? "A:" + tiempo : "B:" + tiempo;
					buzonesControlador[i].send(respuesta);
				}
				else if(recibido.equals(Programa.ACCEDER_A)) {
					if(!Programa.ocupadaCajaA) {
						buzonesControlador[i].send(Programa.CONFIRMACION_A);
						Programa.ocupadaCajaA = true;
					}
					else {
						buzonesControlador[i].send(Programa.NEGACION);
					}		
				}
				else if(recibido.equals(Programa.ACCEDER_B)) {
					if(!Programa.ocupadaCajaB) {
						buzonesControlador[i].send(Programa.CONFIRMACION_B);
						Programa.ocupadaCajaB = true;
					}
					else {
						buzonesControlador[i].send(Programa.NEGACION);
					}		
				} else if (recibido.equals(Programa.LIBERAR + ":A")) {
					Programa.ocupadaCajaA = false;
					//System.out.println("Caja A liberada");
				} else if (recibido.equals(Programa.LIBERAR + ":B")) {
					Programa.ocupadaCajaB = false;
					//System.out.println("Caja B liberada");
				} else if (recibido.equals(Programa.IMPRIMIR) ) {
					if(Programa.ocupadaPantalla == false) {
						Programa.ocupadaPantalla = true;
						buzonesControlador[i].send(Programa.IMPRIMIR_OK);
					}else{
						buzonesControlador[i].send(Programa.NEGACION_PANTALLA);
					}
				}
				else if(recibido.equals(Programa.IMPRIMIR_FIN)){
					Programa.ocupadaPantalla = false;
				}


		}
	}

}
}